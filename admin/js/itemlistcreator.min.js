(function(a){a.extend(a.fn,{createVisformsOptionCreator:function(b){var c=a.data(this[0],"visformsOptionCreator");if(c){return c}c=new a.visformsOptionCreator(b);a.data(this[0],"visformsOptionCreator",c)},storeVisformsOptionCreatorData:function(){var b=a.data(this[0],"visformsOptionCreator");b.storeData()}});a.visformsOptionCreator=function(g){var l={texts:{txtMoveUp:"Move Up",txtMoveDown:"Move Down",txtMoveDragDrop:"Move with drag and drop",txtDelete:"Delete",txtAddItem:"Add item",txtAddAndNewItem:"Add & New",txtCreateItem:"Create item",txtAlertRequired:"Value and Label are required",txtTitle:"Title",txtItemsImported:"Items imported",txtReaderError:"Unable to read file ",txtNoDataToImport:"No data to import!",txtDescr:""},params:{fieldName:"f_radio_list_hidden",idPrefix:"",dbFieldExt:"",hdnMFlds:{},ctype:"",header:"",items:"",rowTemplate:"",storedFieldClass:[]}};var s=a.extend(true,{},l,g);var p=a.map(s.params.hdnMFlds,function(v,e){return v.fname});var h=a.map(s.params.hdnMFlds,function(v,e){if(v.frequired==true){return v.fname}});var i=u();var f=s.params.idPrefix+s.params.fieldName;var q=s.params.idPrefix+"f_"+i+s.params.importField;var j=s.params.idPrefix+"f_"+i+s.params.importSeparator;var n="add"+i;var t="itemListCont"+i;var d="itemList"+i;var k=s.params.idPrefix+"f_"+i+"_lastId";var c=a("#"+k).val();var b=(a().sortable)?"ui-sortable":"notSortable";function u(){var v="";if(s.params.ctype==""){var e=s.params.fieldName.replace("f_","");v=e.replace(s.params.dbFieldExt,"")}else{v=s.params.ctype}return v}var m={createTable:function(){var e='<div id="'+t+'"><div><p><a id="'+n+'" class="btn" href="#">'+s.texts.txtCreateItem+"</a></p>"+((s.texts.txtDescr)?"<p>"+s.texts.txtDescr+"</p>":"")+'<table id="'+d+'" class="'+b+' table table-striped table-condensed" style="position:relative;"><thead>'+s.params.header+"</thead><tbody>"+s.params.items+"</tbody></table></div>";a(e).insertBefore("#"+f);a("#"+t).trigger("subform-row-add",a("#"+d))},createTableRow:function(){var e=a(s.params.rowTemplate).appendTo("#"+d+" tbody");e.find(".itemUp").on("click",m.itemUp);e.find(".itemDown").on("click",m.itemDown);e.find("input.focus").focus()},removeArrowClassDisabled:function(){a("#"+d+" .liItem").find(".itemUp").removeClass("disabled");a("#"+d+" .liItem").find(".itemDown").removeClass("disabled")},setArrowClassDisabled:function(){a("#"+d+" .liItem").first().find(".itemUp").addClass("disabled");a("#"+d+" .liItem").last().find(".itemDown").addClass("disabled")},setArrowDisabledState:function(){m.removeArrowClassDisabled();m.setArrowClassDisabled()},itemUp:function(){a(this).parents(".liItem").insertBefore(a(this).parents(".liItem").prev());m.setArrowDisabledState()},itemDown:function(){a(this).parents(".liItem").insertAfter(a(this).parents(".liItem").next());m.setArrowDisabledState()},setIds:function(){a("#"+d+" .listitemid").each(function(e){if(a(this).val()==""){a(this).val(++c)}})},setLastId:function(){a("#"+k).val(c)},setCountOfDefaultOptions:function(){var e=a("#"+d+" .listitemischecked:checked").length;a("#"+s.params.idPrefix+"f_"+i+"_countDefaultOpts").val(e)},checkRequiredFields:function(){var e=true;a.each(h,function(v,w){a("."+w).each(function(x){if(a(this).val()==""){e=false}})});if(e==false){alert(s.texts.txtAlertRequired)}return e},createHiddenInput:function(){var v={};var e=a("#"+d+" .liItem").not(".listHeader").each(function(y){var x={};var w=a(this).find("input").each(function(z){var A=this;a.each(p,function(B,C){if(a(A).hasClass(C)){if(a(A).attr("type")==="checkbox"){if(a(A).prop("checked")){x[C]="1"}}else{x[C]=a(A).val()}}})});v[y]=x});return JSON.stringify(v)},setItemsStr:function(e){if(e!=""){a("#"+f).val(e)}},browserSupportFileUpload:function(){var e=false;if(window.File&&window.FileReader&&window.FileList&&window.Blob){e=true}return e},importOptions:function(v){if(!m.browserSupportFileUpload()){alert("The File APIs are not fully supported in this browser!")}else{var x=null;var w=v.target.files[0];var e=new FileReader();e.readAsText(w);e.onload=function(B){var D=B.target.result;var C=a("#"+j).val();var A={separator:C};try{x=a.csv.toArrays(D,A)}catch(y){alert(s.texts.txtReaderError);return}if(x&&x.length>0){a("#"+d+" .liItem").remove();var z=[];a.each(x,function(F,E){if(E.length<2){return}if(E[0]===""||E[1]===""){return}z.push('<tr class="liItem">');z.push('<td class="hiddenNotSortable"><span class="itemMove"><i class="icon-menu" title="'+s.texts.txtMoveDragDrop+'"></i></span></td>');z.push('<td class="hiddenSortable"><a class="itemUp" href="#"><i class="icon-arrow-up-3" title="'+s.texts.txtMoveUp+'"></i></a></td>');z.push('<td class="hiddenSortable"><a class="itemDown" href="#" ><i class="icon-arrow-down-3" title="'+s.texts.txtMoveDown+'"></i></a></td>');z.push('<td><input type="hidden" class="itemlist listitemid" value="" /></td>');z.push('<td><input type="text" class="itemlist listitemvalue" value="'+E[0]+'" required="required" /></td>');z.push('<td><input type="text" class="itemlist listitemlabel" value="'+E[1]+'" required="required" /></td>');z.push('<span class="itemValues">'+E[1]+"</span>");if(a.type(E[2])!=="undefined"&&a.type(E[2])!==null&&E[2]!==""){z.push('<td><input type="checkbox" class="itemlist listitemischecked" value="1" checked="checked" /></td>')}else{z.push('<td><input type="checkbox" class="itemlist listitemischecked" value="1" /></td>')}z.push('<a class="itemRemove" href="#">'+s.texts.txtDelete+"</a>");z.push("</tr>")});a("#"+d+" tbody").append(z.join(""));a("#"+d+" tbody").find(".itemUp").on("click",m.itemUp);a("#"+d+" tbody").find(".itemDown").on("click",m.itemDown);m.setArrowDisabledState();alert(s.texts.txtItemsImported)}else{alert(s.texts.txtNoDataToImport)}};e.onerror=function(){alert(s.texts.txtReaderError)}}}};function o(){m.setCountOfDefaultOptions();if(!m.checkRequiredFields()){return false}m.setIds();m.setLastId();m.setItemsStr(m.createHiddenInput())}m.createTable();m.setArrowClassDisabled();a("#"+n).on("click",function(v){v.preventDefault();m.createTableRow();m.setArrowDisabledState()});a(".itemRemove").on("click",function(v){v.preventDefault();a(this).parents(".liItem").remove();m.setArrowDisabledState()});a(".itemUp").on("click",m.itemUp);a(".itemDown").on("click",m.itemDown);a("#"+q).on("change",m.importOptions);if(a().sortable){try{a("#"+d).sortable({items:".liItem",cancel:"input",addClasses:false,tolerance:"pointer",axis:"y",containment:"parent",helper:function(w,v){jQuery(v).css({left:"0px"});v.children().each(function(){jQuery(this).width(jQuery(this).width())});jQuery(v).children("td").addClass("dndlist-dragged-row");return v},start:function(e,v){this.idx=v.item.index()},update:function(e,v){m.setArrowDisabledState()}})}catch(r){}}return{storeData:o}}}(jQuery));